{% extends 'base.html' %}
{% load static %}

{% block full_width_banner %}{% endblock %}
{% block full_width_sticky_nav %}{% endblock %}

{% block title %}{{ title }}{% endblock %}

{% block main_container %}
<main class="flex-grow w-full bg-gray-50">

    {# --- 1. Javascript & Data Logic (Extracted) --- #}
    {% include 'core/partials/manage_scripts.html' %}

    {# --- 2. Main App Root --- #}
    <div id="manage-tools-root" class="flex flex-col md:flex-row min-h-screen" x-data="manageTools"
         {# Event Listeners attached to window/root #}
         @open-product-edit-modal.window="openProductEditModal($event.detail)"
         @open-upload-quotation-modal.window="uploadQuotationModalOpen = true"
         @open-create-quotation-modal.window="createQuotationModalOpen = true"
         @open-upload-batch-modal.window="uploadBatchModalOpen = true"
         @open-pricing-modal.window="openPricingModal($event.detail)"
         @open-upload-product-modal.window="uploadProductModalOpen = true"
         @open-seo-modal.window="openSeoModal($event.detail)"
         @open-category-modal.window="openCategoryModal($event.detail)"
         @close-receive-modal.window="closeReceiveStockModal()"
         @images-open-edit.window="Alpine.store('images').openImageEditModal($event.detail)"
         @images-handle-upload.window="Alpine.store('images').handleImageUpload($event)"
         @images-delete.window="Alpine.store('images').deleteImage($event.detail)"
         @images-open-assign-product.window="Alpine.store('images').openAssignProductModal($event.detail)"
         @images-open-assign-post.window="Alpine.store('images').openAssignPostModal($event.detail)"
         @images-open-bulk-assign.window="Alpine.store('images').openBulkAssignModal()"
         @images-submit-product-assign.window="Alpine.store('images').submitProductAssignment()"
         @images-submit-post-assign.window="Alpine.store('images').submitPostAssignment()"
         @images-submit-bulk-assign.window="Alpine.store('images').submitBulkAssignment()"
         @images-update-product-selections.window="Alpine.store('images').updateProductModalSelections()"
         @images-update-post-selections.window="Alpine.store('images').updatePostModalSelections()"
    >

        {# --- Sidebar --- #}
        <aside class="w-full md:w-64 bg-white border-r border-gray-200 flex-shrink-0 z-30">
            <div class="sticky top-16 md:h-[calc(100vh-4rem)] overflow-y-auto py-4">
                 {% include 'core/partials/manage_tabs.html' %}
            </div>
        </aside>

        {# --- Main Content Area --- #}
        <div class="flex-1 w-full max-w-7xl mx-auto p-4 md:p-8 overflow-x-hidden">

            {% if messages %}
            <div class="mb-4 space-y-2">
                {% for message in messages %}
                 <div class="px-4 py-3 rounded relative
                    {% if message.tags == 'success' %} bg-green-100 border border-green-400 text-green-700
                    {% elif message.tags == 'warning' %} bg-yellow-100 border border-yellow-400 text-yellow-700
                    {% elif message.tags == 'error' %} bg-red-100 border border-red-400 text-red-700
                    {% else %} bg-blue-100 border border-blue-400 text-blue-700
                    {% endif %}" role="alert">
                    <span class="block sm:inline">{{ message }}</span>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {# --- Tab Content Panels --- #}
            <div>
                <div x-show="tab === '#quotations'" id="quotations" x-cloak>{% include 'inventory/partials/quotations_tab.html' %}</div>
                <div x-show="tab === '#invoices'" id="invoices" x-cloak>{% include 'inventory/partials/invoices_tab.html' %}</div>
                <div x-show="tab === '#inventory'" id="inventory" x-cloak>{% include 'inventory/partials/inventory_tab.html' %}</div>
                <div x-show="tab === '#products'" id="products" x-cloak>{% include 'product/manage_products_tab.html' %}</div>
                <div x-show="tab === '#categories'" id="categories" x-cloak>{% include 'product/manage_categories_tab.html' %}</div>
                <div x-show="tab === '#blog'" id="blog" x-cloak>{% include 'blog/manage_blog_tab.html' %}</div>
                <div x-show="tab === '#seo'" id="seo" x-cloak>{% include 'seo/manage_seo_tab.html' %}</div>
                <div x-show="tab === '#images'" id="images" x-cloak>{% include 'images/manage_images_tab.html' %}</div>
                <div x-show="tab === '#agents'" id="agents" x-cloak>{% include 'user/manage_agents_tab.html' %}</div>
                <div x-show="tab === '#banners'" id="banners" x-cloak>{% include 'core/partials/manage_banners_tab.html' %}</div>
                <div x-show="tab === '#commissions'" id="commissions" x-cloak>{% include 'commission/manage_commissions_tab.html' %}</div>

                <div x-show="tab === '#orders'" id="orders" x-cloak>
                     <div class="bg-white shadow sm:rounded-lg p-6 text-center">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Order Management</h3>
                        <p class="mt-2 max-w-xl text-sm text-gray-500 mx-auto">
                            Manage agent orders, view statistics, and update statuses in the dedicated panel.
                        </p>
                        <div class="mt-5">
                            <a href="{% url 'order:manage_orders' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Open Order Management Panel &rarr;
                            </a>
                        </div>
                     </div>
                </div>
            </div>
        </div>

        {# --- 3. Modals Container (Extracted) --- #}
        {% include 'core/partials/manage_modals_container.html' %}

    </div>

</main>
{% endblock %}
{% block content %}{% endblock %}
