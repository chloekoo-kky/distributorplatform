<div x-show="editModalOpen" id="editInvoiceModal" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-75"
    x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0"
    x-transition:enter-end="opacity-100" x-transition:leave="ease-in duration-200"
    x-transition:leave-start="opacity-100" x-transition:leave-end="opacity-0" style="display: none;">

    <div @click.away="editModalOpen = false"
        class="relative bg-white rounded-lg shadow-xl w-full max-w-lg p-8 m-4"
        x-transition:enter="ease-out duration-300" x-transition:enter-start="opacity-0 transform scale-95"
        x-transition:enter-end="opacity-100 transform scale-100"
        x-transition:leave="ease-in duration-200" x-transition:leave-start="opacity-100 transform scale-100"
        x-transition:leave-end="opacity-0 transform scale-95">

        <button @click="editModalOpen = false" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
        </button>
        <h3 class="text-2xl font-bold text-gray-800 mb-6">Edit Invoice <span x-text="currentInvoice.invoice_id" class="text-indigo-600"></span></h3>

        <template x-if="editModalOpen">
            <form id="edit-invoice-form" @submit.prevent="submitInvoiceUpdate">
                {% csrf_token %}
                <div class="space-y-4">
                    <div>
                        <label for="id_edit_status" class="font-semibold text-gray-700 block mb-1">Status</label>
                        <select name="status" id="id_edit_status" x-model="currentInvoice.status" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                            {% for value, display in invoice_status_choices %}
                                <option value="{{ value }}">{{ display }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div>
                        <label for="id_edit_payment_date" class="font-semibold text-gray-700 block mb-1">Payment Date</label>
                        <input type="date" name="payment_date" id="id_edit_payment_date" x-model="currentInvoice.payment_date" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                         <p class="text-xs text-gray-500 mt-1">Leave blank unless status is 'Paid'. Will be set automatically if status is 'Paid' and date is blank.</p>
                    </div>
                    <div>
                        <label for="id_edit_notes" class="font-semibold text-gray-700 block mb-1">Notes</label>
                        <textarea name="notes" id="id_edit_notes" x-model="currentInvoice.notes" rows="3" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" @click="editModalOpen = false" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        Save Changes
                    </button>
                </div>
            </form>
        </template>
    </div>
</div>
